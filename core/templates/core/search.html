{% extends "base.html" %}
{% load static %}

{% block title %}
    {% if query %}Search Results for "{{ query }}"{% else %}Search Products{% endif %} - OwniesVerse
{% endblock %}

{% block content %}
<div class="container py-5">
    <h2 class="title text-center mb-5 fw-bold">
        {% if query %}
            Search Results for "<span class="text-ownies">{{ query }}</span>"
            <small class="text-muted ms-3">({{ count }} item{{ count|pluralize }})</small>
        {% else %}
            Search All Products
        {% endif %}
    </h2>

    {% if products %}
    <div class="row row-cols-1 row-cols-xs-2 row-cols-sm-2 row-cols-lg-3 g-4">
        {% for i in products %}
        <div class="col hp">
            <div class="card h-100 product-card border-0 shadow-sm overflow-hidden">

                <!-- FULLY VISIBLE IMAGE WITH PADDING -->
                <div class="bg-light position-relative">
                    <a href="{% url 'product_detail' i.id %}">
                        <img src="{{ i.image.url }}" 
                             class="w-100" 
                             alt="{{ i.name }}"
                             style="height: 320px; object-fit: contain; padding: 30px;">
                    </a>

                    <!-- Title Overlay on Top -->
                    <div class="label-top shadow">
                        <a class="text-white fw-bold text-decoration-none small d-block px-2" 
                           href="{% url 'product_detail' i.id %}">
                            {{ i.name|truncatechars:50 }}
                        </a>
                    </div>
                </div>

                <div class="card-body d-flex flex-column p-4">
                    <!-- Price + Reviews -->
                    <div class="clearfix mb-3">
                        <span class="float-start badge rounded-pill bg-success fs-6">
                            Rs. {{ i.price|floatformat:0 }}
                        </span>
                        <span class="float-end">
                            <a href="{% url 'product_detail' i.id %}#reviews" 
                               class="small text-muted text-uppercase text-decoration-none">
                                reviews
                            </a>
                        </span>
                    </div>

                    <!-- Short Description -->
                    <h5 class="card-title flex-grow-1 mb-4">
                        <a href="{% url 'product_detail' i.id %}" 
                           class="text-dark text-decoration-none">
                            {{ i.desc|striptags|truncatewords:15 }}
                        </a>
                    </h5>

                    <!-- Add to Cart Button -->
                    <div class="d-grid gap-2 my-4">
                        <a href="{% url 'cart_add' i.id %}" 
                           class="btn btn-gradient bold-btn py-3 fw-bold text-uppercase">
                            Add to cart
                        </a>
                    </div>

                    <!-- Info + Heart Icons -->
                    <div class="clearfix">
                        <span class="float-start">
                            <a href="{% url 'product_detail' i.id %}" class="text-muted">
                                <i class="fas fa-question-circle fs-5"></i>
                            </a>
                        </span>
                        <span class="float-end">
                            <a href="{% url 'wishlist' %}">
                            <i class="far fa-heart text-danger hover-heart fs-5" 
                               style="cursor: pointer;"></i>
                               </a>
                        </span>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    {% else %}
        {% if query %}
        <div class="text-center py-5">
            <i class="fas fa-search fa-5x text-muted mb-4 opacity-50"></i>
            <h3 class="text-muted">No products found</h3>
            <p class="lead text-muted">We couldn't find anything for "<strong>{{ query }}</strong>"</p>
            <a href="{% url 'index' %}" class="btn btn-gradient btn-lg px-5">
                Back to Home
            </a>
        </div>
        {% endif %}
    {% endif %}
</div>
{% endblock %}